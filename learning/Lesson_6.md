# Урок 6 — solana-test-validator: локальная сеть для разработки

---

## 1. Введение

При разработке dApp и программ для Solana удобно иметь возможность запускать **локальную копию сети**.  
Это позволяет тестировать транзакции, создавать токены и проверять смарт-контракты без риска и без подключения к интернету.

Для этого используется инструмент **`solana-test-validator`** — встроенный в CLI локальный узел, который имитирует работу настоящей сети Solana.

> Подробная информация: [Solana Test Validator](https://docs.solanalabs.com/cli/examples/test-validator)

---

## 2. Что такое test-validator

`solana-test-validator` — это локальный RPC-узел и валидатор Solana, который работает только на вашем компьютере.  
Он создаёт изолированную среду, где можно:

- тестировать программы и транзакции;
- выполнять переводы SOL без настоящих средств;
- проверять работу аккаунтов и PDA;
- запускать интеграционные тесты без внешних зависимостей.

В отличие от Devnet и Testnet, локальный узел не требует подключения к интернету и запускается моментально.

---

## 3. Основные возможности и аргументы запуска

Запуск локального валидатора выполняется простой командой:

```bash
solana-test-validator
```

**Популярные параметры:**

| Аргумент | Назначение |
|-----------|------------|
| `--reset` | Очистить все данные перед запуском. |
| `--limit-ledger-size` | Ограничить размер леджера для экономии памяти. |
| `--bpf-program <address> <path>` | Автоматически загрузить смарт-контракт при запуске. |
| `--mint <pubkey>` | Указать аккаунт, получающий начальные SOL. |
| `--quiet` | Запуск без лишних логов. |

После запуска вы увидите строку (пример):

```
Ledger location: test-ledger
Log: test-ledger/validator.log
Identity: EPhgPANa5Rh2wa4V2jxt7YbtWa3Uyw4sTeZ13cQjDDB8
Genesis Hash: 4754oPEMhAKy14CZc8GzQUP93CB4ouELyaTs4P8ittYn
Version: 1.6.7
Shred Version: 13286
Gossip Address: 127.0.0.1:1024
TPU Address: 127.0.0.1:1027
JSON RPC URL: http://127.0.0.1:8899
⠈ 00:36:02 | Processed Slot: 5142 | Confirmed Slot: 5142 | Finalized Slot: 5110 | Snapshot Slot: 5100 | Transactions: 5142 | ◎499.974295000
```

Это означает, что локальная сеть готова к работе.

---

## 4. Сравнение с Devnet и Testnet

| Критерий | Test-validator | Devnet | Testnet |
|-----------|----------------|---------|----------|
| Подключение к интернету | ❌ Нет | ✅ Да | ✅ Да |
| Среда для тестирования | Полностью локальная | Публичная | Публичная, системная |
| Производительность | Максимальная (локально) | Средняя | Переменная |
| Сброс данных | Каждый запуск | По решению Solana | По решению Solana |
| Использование реальных SOL | ❌ Нет | ❌ Нет | ❌ Нет |

Test-validator идеально подходит для локальных интеграционных тестов и разработки смарт-контрактов.

---

## 5. Подключение Python-клиента к локальной сети

Когда локальный узел запущен, можно подключаться к нему через Python-клиент по адресу `http://127.0.0.1:8899`.

Используем код из [`examples/Python/L6-Test_Validator.py`](../examples/Python/L6-Test_Validator.py):

```python
from solana.rpc.api import Client
from solders.keypair import Keypair
from solders.pubkey import Pubkey

# Подключаемся к локальному RPC
client = Client("http://127.0.0.1:8899")

# Создаём новый кошелёк
wallet = Keypair()
print("Адрес нового кошелька:", wallet.pubkey())

# Проверяем доступность узла
status = client.is_connected()
print("Подключение активно:", status)

# Проверяем номер текущего слота
slot = client.get_slot().value
print("Текущий слот:", slot)

# Проверяем баланс системного аккаунта
address = Pubkey.from_string("11111111111111111111111111111111")
info = client.get_account_info(address)
print("Информация об аккаунте:", info.value)
```

**Что происходит:**
- клиент подключается к локальному RPC-узлу;
- проверяет соединение и получает информацию о блокчейне;
- обращается к системному аккаунту для проверки связи.

> В локальной сети можно свободно выполнять переводы, создавать токены и аккаунты — всё работает так же, как в настоящем Devnet, но без ограничений и задержек.

---

## 6. Практика

1. Запустите `solana-test-validator` в отдельном терминале.  
2. Откройте новый терминал и выполните `solana config set --url http://127.0.0.1:8899`.
3. Проверьте соединение командой `solana balance` — вы подключены к локальному RPC.
4. Запустите приведённый Python-скрипт и убедитесь, что он получает слот и данные аккаунта.
5. Попробуйте добавить `request_airdrop()` и перевести токены внутри локальной сети.

---

## 7. Вопросы для самопроверки

1. Что делает `solana-test-validator` и чем он отличается от Devnet?
2. Почему локальная сеть быстрее и безопаснее для тестов?
3. Как подключить Python-приложение к локальной сети Solana?
4. Что происходит при запуске с флагом `--reset`?
5. Почему для интеграционных тестов предпочтителен локальный узел?

---

## 8. Навигация

[← Урок 5 — Solana CLI: основные команды (keygen, airdrop, balance, transfer)](Lesson_5.md)  
[→ Урок 7 — Знакомство с solana: возможности, уровни API](Lesson_7.md)

